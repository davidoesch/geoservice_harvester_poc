<!DOCTYPE html>
<html>

<head>
    <title>PoC GeoServiceHarvester</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Include jQuery, DataTables CSS, and DataTables JS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        table.dataTable {
            width: 100% !important;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script>
        var cookies = document.cookie.split('; ');
        for (var i = 0; i < cookies.length; i++) {
            var parts = cookies[i].split('=');
            if (parts[0] === 'PHPSESSID') {
                var sessionId = parts[1];
                // Do something with sessionId
                document.cookie = "PHPSESSID=" + sessionId + "; SameSite=None; Secure";
                break;
            }
        }
        $(document).ready(function() {
            // Load CSV file with PapaParse and DataTables
            Papa.parse("https://raw.githubusercontent.com/davidoesch/geoservice_harvester_poc/main/data/geoservices_CH.csv", {
                download: true,
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    var table = $('#table').DataTable({
                        "data": results.data,
                        "columns": [{
                            "data": "OWNER",
                            "title": "Owner"
                        }, {
                            "data": "TITLE",
                            "title": "Title"
                        }, {
                            "data": "MAPGEO",
                            "title": "Map Geo",
                            "render": function(data, type, row) {
                                if (row.SERVICETYPE === "WFS") {
                                    return "WFS";
                                } else if (type === "display") {
                                    return "<a href='#' onclick='window.open(\"" + data + "\")'>OpenMap</a>";
                                }
                                return data;
                            }
                        }, {
                            "data": "ABSTRACT",
                            "title": "Abstract"
                        }, {
                            "data": "KEYWORDS",
                            "title": "Keywords"
                        }, {
                            "data": "CONTACT",
                            "title": "Contact"
                        }, {
                            "data": "LEGEND",
                            "title": "Legend",
                            "render": function(data, type, row) {
                                if (type === "display") {
                                    return "<a href='#' onclick='window.open(\"" + data + "\")'>Legend</a>";
                                }
                                return data;
                            }
                        }, {
                            "data": "METADATA",
                            "title": "Metadata",
                            "render": function(data, type, row) {
                                if (type === "display") {
                                    return "<a href='#' onclick='window.open(\"" + data + "\")'>Metadata</a>";
                                }
                                return data;
                            }
                        }, ],
                        "order": [
                            [0, "asc"]
                        ], // Default sort by 'TITLE' ascending
                        "paging": true, // Enable pagination
                        "lengthMenu": [10, 25, 50, 100], //
                        "columnDefs": [{
                            "targets": 1,
                            "width": "60%"
                        }, {
                            "targets": 3,
                            "width": "40%"
                        }, {
                            "targets": [0, 2, 4, 5, 6, 7],
                            "width": "10%"
                        }],
                        "responsive": true // added option for responsive table
                    });
                    $('#toggle-columns').on('click', function() {
                        table.columns().visible(!table.column(0).visible());
                    });
                }
            });
        });
    </script>
</head>

<body>
    <h1>GeoServiceHarvester POC</h1>
    <p>| All DATA attributes: <a href="https://github.com/davidoesch/geoservice_harvester_poc/blob/main/data/geodata_CH.csv">download</a> || All SERVICES attributes: <a href="https://github.com/davidoesch/geoservice_harvester_poc/blob/main/data/geoservices_CH.csv">download</a> || Source Code: <a href="https://github.com/davidoesch/geoservice_harvester_poc">GitHub</a> || Quality Control: <a href="#anchor-QualityControl"> view</a> || Last Update: <img src="https://img.shields.io/github/last-commit/davidoesch/geoservice_harvester_poc" alt="LastUpdate"> | </p>
    <p> Please be patient - over 15'000 datasets to load takes time. </a>
    </p>
    <table id="table" class="display">
        <thead>
            <tr>
                <th>OWNER</th>
                <th>TITLE</th>
                <th>ABSTRACT</th>
                <th>KEYWORDS</th>
                <th>SERVICELINK</th>
                <th>CONTACT</th>
                <th>LEGEND</th>
                <th>METADATA</th>
            </tr>
        </thead>
    </table>
    <p>
        <a id="anchor-QualityControl"><b>Quality Control</b></a>
        <br>
        <iframe title="Completness Average:  KEYWORDS,ABSTRACT, CONTACT and METADATA" aria-label="Balken (gestapelt)" id="datawrapper-chart-DuVHo" src="https://datawrapper.dwcdn.net/DuVHo/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="721" data-external="1"></iframe>
        <script type="text/javascript">
            ! function() {
                "use strict";
                window.addEventListener("message", (function(e) {
                    if (void 0 !== e.data["datawrapper-height"]) {
                        var t = document.querySelectorAll("iframe");
                        for (var a in e.data["datawrapper-height"])
                            for (var r = 0; r < t.length; r++) {
                                if (t[r].contentWindow === e.source) t[r].style.height = e.data["datawrapper-height"][a] + "px"
                            }
                    }
                }))
            }();
        </script>
        <br>
        <iframe title="Completness of KEYWORD ABSTRACT CONTACT AND METADATA dataset in services " aria-label="Balken (separat)" id="datawrapper-chart-XoJn7" src="https://datawrapper.dwcdn.net/XoJn7/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="711" data-external="1"></iframe>
        <script type="text/javascript">
            ! function() {
                "use strict";
                window.addEventListener("message", (function(e) {
                    if (void 0 !== e.data["datawrapper-height"]) {
                        var t = document.querySelectorAll("iframe");
                        for (var a in e.data["datawrapper-height"])
                            for (var r = 0; r < t.length; r++) {
                                if (t[r].contentWindow === e.source) t[r].style.height = e.data["datawrapper-height"][a] + "px"
                            }
                    }
                }))
            }();
        </script>
</body>

</html>
